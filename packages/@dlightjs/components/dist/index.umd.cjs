(function(h,a){typeof exports=="object"&&typeof module<"u"?a(exports,require("@dlightjs/dlight")):typeof define=="function"&&define.amd?define(["exports","@dlightjs/dlight"],a):(h=typeof globalThis<"u"?globalThis:h||self,a(h.component={},h._$))})(this,function(h,a){"use strict";var C=Object.defineProperty;var R=(h,a,c)=>a in h?C(h,a,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[a]=c;var e=(h,a,c)=>(R(h,typeof a!="symbol"?a+"":a,c),c);function c(o){const d=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(o){for(const t in o)if(t!=="default"){const r=Object.getOwnPropertyDescriptor(o,t);Object.defineProperty(d,t,r.get?r:{enumerable:!0,get:()=>o[t]})}}return d.default=o,Object.freeze(d)}const p=c(a);class E extends a.View{constructor(){super(...arguments);e(this,"_$tag","Spacer");e(this,"Body",()=>[new p.HtmlNode("div")])}}function f(o){if(![a.DLNodeType.HTML,a.DLNodeType.Text].includes(o._$nodeType)){if(o._$tag==="Spacer")return!0;for(let d of o._$nodes??[])if(f(d))return!0}return!1}class x extends a.View{constructor(){super(...arguments);e(this,"_$derivedPairs",{margin:["alignment"]});e(this,"_$deps",{spacing:new Map,alignment:new Map,width:new Map,height:new Map,margin:new Map});e(this,"_$tag","HStack");e(this,"_$$spacing","_$prop");e(this,"spacing",10);e(this,"_$$alignment","_$prop");e(this,"alignment","top");e(this,"_$$width","_$prop");e(this,"width","100%");e(this,"_$$height","_$prop");e(this,"height","max-content");e(this,"margin",()=>function(){switch(this.alignment){case"top":return"0 0 auto 0";case"bottom":return"auto 0 0 0";case"center":return"auto 0";default:return""}}.call(this));e(this,"Body",()=>{const t=new p.HtmlNode("div");return t._$addProp("_height",()=>this.height,this,["height"]),t._$addProp("_width",()=>this.width,this,["width"]),t._$addProp("_columnGap",()=>`${this.spacing}px`,this,["spacing"]),t._$addProp("_display","flex"),t._$addProp("_flexDirection","row"),t._$addNodes((()=>{const r=new p.ForNode;return r._$addNodess(Array.from(this._$children.map(i=>i())).map(i=>(()=>{const s=new p.IfNode;return s._$addCond(()=>f(i),()=>{const n=new p.ExpressionNode(i);return n._$addProp("_flexGrow",1),[n]}),s._$addCond(()=>!0,()=>{const n=new p.ExpressionNode(i);return n._$addProp("_flexShrink",0),n._$addProp("_margin",()=>this.margin,this,["margin"],!0),[n]}),[s]})())),[r]})()),[t]})}}class N extends a.View{constructor(){super(...arguments);e(this,"_$derivedPairs",{margin:["alignment"]});e(this,"_$deps",{spacing:new Map,alignment:new Map,width:new Map,height:new Map,margin:new Map});e(this,"_$tag","VStack");e(this,"_$$spacing","_$prop");e(this,"spacing",10);e(this,"_$$alignment","_$prop");e(this,"alignment","top");e(this,"_$$width","_$prop");e(this,"width","max-content");e(this,"_$$height","_$prop");e(this,"height","100%");e(this,"margin",()=>function(){switch(this.alignment){case"top":return"0 auto 0 0";case"bottom":return"0 0 0 auto";case"center":return"0 auto";default:return""}}.call(this));e(this,"Body",()=>{const t=new p.HtmlNode("div");return t._$addProp("_height",()=>this.height,this,["height"]),t._$addProp("_width",()=>this.width,this,["width"]),t._$addProp("_columnGap",()=>`${this.spacing}px`,this,["spacing"]),t._$addProp("_display","flex"),t._$addProp("_flexDirection","column"),t._$addNodes((()=>{const r=new p.ForNode;return r._$addNodess(Array.from(this._$children.map(i=>i())).map(i=>(()=>{const s=new p.IfNode;return s._$addCond(()=>f(i),()=>{const n=new p.ExpressionNode(i);return n._$addProp("_flexGrow",1),[n]}),s._$addCond(()=>!0,()=>{const n=new p.ExpressionNode(i);return n._$addProp("_flexShrink",0),n._$addProp("_margin",()=>this.margin,this,["margin"],!0),[n]}),[s]})())),[r]})()),[t]})}}class M extends a.View{constructor(){super(...arguments);e(this,"_$deps",{hAlignment:new Map,vAlignment:new Map,width:new Map,height:new Map});e(this,"_$tag","ZStack");e(this,"_$$hAlignment","_$prop");e(this,"hAlignment","center");e(this,"_$$vAlignment","_$prop");e(this,"vAlignment","center");e(this,"_$$width","_$prop");e(this,"width","max-content");e(this,"_$$height","_$prop");e(this,"height","max-content");e(this,"Body",()=>{const t=new p.HtmlNode("div");return t._$addProp("_height",()=>this.height,this,["height"]),t._$addProp("_width",()=>this.width,this,["width"]),t._$addProp("_columnGap",`${this.spacing}px`),t._$addProp("_display","grid"),t._$addProp("_alignItems",()=>({top:"flex-start",center:"center",bottom:"flex-end"})[this.vAlignment],this,["vAlignment"]),t._$addProp("_justifyItems",()=>({leading:"left",center:"center",tailing:"right"})[this.hAlignment],this,["hAlignment"]),t._$addNodes((()=>{const r=new p.ForNode;return r._$addNodess(Array.from(this._$children.map(i=>i())).map(i=>(()=>{const s=new p.ExpressionNode(i);return s._$addProp("_position","relative"),s._$addProp("_gridArea","1 / 1/ 1 / 1"),[s]})())),[r]})()),[t]})}}function w(){return location.hash.slice(2)}function v(){return location.pathname.slice(1)}function y(o,d){let t;if(o[0]==="/")t=o;else{o[0]!=="."&&(o="./"+o);const r=o.split("/"),i=d.split("/").filter(n=>n);let s=0;for(let n of r){if(![".",".."].includes(n))break;n===".."&&(i.length===0&&console.warn(`no ../ in ${o}`),i.pop()),s++}t="/"+[...i,...r.slice(s)].join("/")}return t}class P{constructor(){e(this,"mode","hash");e(this,"baseUrl","")}hashTo(d){window.location.href="#"+y(d,this.baseUrl)}historyTo(d){window.history.pushState({},"",y(d,this.baseUrl))}to(d){if(this.mode==="hash"){this.hashTo(d);return}this.historyTo(d)}}class U extends a.View{constructor(){super(...arguments);e(this,"_$deps",{_$content:new Map});e(this,"_$tag","Route");e(this,"_$$_$content","_$prop");e(this,"_$content"," none");e(this,"Body",()=>{var r;return[new p.ExpressionNode((r=this._$children)==null?void 0:r.map(i=>i()))]})}}const m=history.pushState;let $=[];class S extends a.View{constructor(){super(...arguments);e(this,"_$derivedPairs",{currUrl:["mode"],showedRoute:["currUrl"]});e(this,"_$deps",{mode:new Map,navigator:new Map,currUrl:new Map,showedRoute:new Map});e(this,"_$tag","RouterSpace");e(this,"_$$mode","_$prop");e(this,"mode","history");e(this,"_$$navigator");e(this,"_$$currUrl",()=>this.mode==="hash"?w():v());e(this,"baseUrl","");e(this,"prevPathCondition","");e(this,"prevRoutes",[]);e(this,"showedRoute",()=>function(){const t=this.prevPathCondition;this.prevPathCondition="";const r=this.currUrl.replace(new RegExp(`^${this.baseUrl}`),"");let i=[];for(let s of this._$children){const n=s();if(n._$tag!=="Route"){i.push(n);continue}let l=n._$content,u=!1;if(typeof n._$content=="string"){l=l.replace(/^(\.\/)+/,"");const _=l==="."&&r==="",g=(r+"/").startsWith(l+"/");u=_||g||l===" none"}else l instanceof RegExp&&(u=l.test(r));if(u){if(l===t)return this.prevPathCondition=t,this.prevRoutes;i.push(n),this.prevPathCondition=l;break}}return this.prevRoutes=i,i}.call(this));e(this,"historyChangeListen",()=>{this.currUrl=v()});e(this,"hashChangeListen",()=>{this.currUrl=w()});e(this,"Body",()=>{const t=new p.EnvNode;return t._$addNodes((()=>[new p.ExpressionNode(()=>this.showedRoute,this,["showedRoute"])])()),t._$addProp("RouteParam",()=>({path:this.currUrl,navigator:this.navigator}),this,["currUrl","navigator"],!1),[t]})}get navigator(){return this._$$navigator}set navigator(t){this._$$navigator!==t&&(this._$$navigator=t,this._$runDeps("navigator"))}get currUrl(){return this._$$currUrl}set currUrl(t){this._$$currUrl!==t&&(this._$$currUrl=t,this._$runDeps("currUrl"))}didMount(){if(this.mode==="hash"){addEventListener("load",this.hashChangeListen),addEventListener("hashchange",this.hashChangeListen);return}addEventListener("load",this.historyChangeListen),addEventListener("popstate",this.historyChangeListen),$.push(this.historyChangeListen),history.pushState=new Proxy(m,{apply:(t,r,i)=>{const s=t.apply(r,i);for(let n of $)n();return s}})}willUnmount(){if(this.mode==="hash"){removeEventListener("load",this.hashChangeListen),removeEventListener("hashchange",this.hashChangeListen);return}removeEventListener("load",this.historyChangeListen),removeEventListener("popstate",this.historyChangeListen),$=$.filter(t=>t!==this.historyChangeListen),$.length>0?history.pushState=new Proxy(m,{apply:(t,r,i)=>{const s=t.apply(r,i);for(let n of $)n();return s}}):history.pushState=m}AfterConstruct(){let t=this._$parentNode;for(;t;)t._$tag==="Route"&&(this.baseUrl=t._$content+"/"+this.baseUrl),t=t._$parentNode}Preset(){const t=new P;t.mode=this.mode,t.baseUrl=this.baseUrl,this.navigator=t}}class L extends a.View{constructor(){super(...arguments);e(this,"_$derivedPairs",{durationMili:["duration"]});e(this,"_$deps",{duration:new Map,durationMili:new Map,prevElInfos:new Map});e(this,"_$tag","Transition");e(this,"_$$duration","_$prop");e(this,"duration",.5);e(this,"durationMili",()=>this.duration*1e3);e(this,"_$$prevElInfos");e(this,"getElInfos",()=>a.toEls(this._$children.map(t=>t())).reduce((t,r)=>(t.set(r,r.getBoundingClientRect()),t),new Map));e(this,"Body",()=>{const t=new p.ExpressionNode(this._$children.map(r=>r()));return t.deepLoopEl=!0,t._$addProp("_transition",()=>`all ${this.duration}s`,this,["duration"],!1),t._$onUpdateNodes((r,i)=>{const s=this.getElInfos();for(let[n,l]of this.prevElInfos.entries())if(s.has(n)){const u=s.get(n),_=l.x-u.x,g=l.y-u.y;if(_===0&&g===0)continue;n.style.transform=`translate(${_}px, ${g}px)`,n.style.transitionDuration="0s",setTimeout(()=>{n.style.transform="",n.style.transitionDuration=`${this.duration}s`},0)}else n.style.opacity="0",setTimeout(()=>{n.style.opacity="1"},0);this.prevElInfos=s}),t._$addLifeCycle(r=>{for(let i of r._$el)console.log(i),i.style.opacity="0",setTimeout(()=>{i.style.opacity=""},0)},"didMount"),[t]})}get prevElInfos(){return this._$$prevElInfos}set prevElInfos(t){this._$$prevElInfos!==t&&(this._$$prevElInfos=t,this._$runDeps("prevElInfos"))}didMount(){this.prevElInfos=this.getElInfos(),setTimeout(()=>{this.prevElInfos=this.getElInfos()},0)}}h.HStack=x,h.Navigator=P,h.Route=U,h.RouterSpace=S,h.Spacer=E,h.Transition=L,h.VStack=N,h.ZStack=M,Object.defineProperty(h,Symbol.toStringTag,{value:"Module"})});
